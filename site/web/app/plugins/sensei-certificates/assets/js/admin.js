jQuery(function(e){"use strict";var i,t;window.send_to_editor_default=window.send_to_editor;var a=sensei_certificate_templates_params.primary_image_width,r=sensei_certificate_templates_params.primary_image_height;function n(){e(".field_pos").each(function(i,t){t=e(t);var r=e("#field"+t.attr("id")),n=e("#certificate_image_0");if(""!=n.attr("src")){var s=1;a!=n.width()&&(s=n.width()/a);var c=t.val()?t.val().split(",").map(function(e){return parseInt(e)*s}):null;if(0==r.length){var d=t.prev().find("label").html();d=d.substr(0,d.length-9),e("#certificate_image_wrapper").append('<span id="field'+t.attr("id")+'" class="certificate_field" style="display:none;">'+d+"</span>"),e("#field"+t.attr("id")).click(function(e){l(e.target.id.substr(6))}),r=e("#field"+t.attr("id"))}c?(r.css({left:c[0]+"px",top:c[1]+"px",width:c[2]+"px",height:c[3]+"px"}),r.show()):r.hide()}else r&&r.hide()})}function l(i){if(e("img#certificate_image_0").attr("src"))if(s(),e("#"+i).val()!=sensei_certificate_templates_params.done_label){e("#field_"+i).hide();var t=e("#_"+i).val()?e("#_"+i).val().split(",").map(function(e){return parseInt(e)}):[null,null,null,null];e("input.set_position").val(sensei_certificate_templates_params.set_position_label),e("#"+i).val(sensei_certificate_templates_params.done_label),e("img#certificate_image_0").imgAreaSelect({show:!0,handles:!0,instance:!0,imageWidth:a,imageHeight:r,x1:t[0],y1:t[1],x2:t[0]+t[2],y2:t[1]+t[3],onSelectEnd:function(t,a){!function(i,t){e("#_"+t).val(i.x1+","+i.y1+","+i.width+","+i.height),e("#remove_"+t).show()}(a,i)}}),e(document).scrollTop()>e("img#certificate_image_0").offset().top+e("img#certificate_image_0").height()*(2/3)&&e("html, body").animate({scrollTop:e("#title").offset().top},500)}else e("#"+i).val(sensei_certificate_templates_params.set_position_label)}function s(){e("img#certificate_image_0").imgAreaSelect({remove:!0}),n()}function c(){e(".remove-alternative-certificate-image").click(function(){var i=e(this).parent(),t=i;return e("input",t).val(""),e("img",t).attr("src",""),i.hide(),!1})}e("#set-certificate-image, #set-additional-image, #add-alternative-certificate-image").live("click",function(n){n.preventDefault(),t=e(this),i?i.open():((i=wp.media.frames.file_frame=wp.media({title:"Select an Image",button:{text:"Set Image"},multiple:!1})).on("select",function(){var n=i.state().get("selection").first().toJSON();if(a=n.width,r=n.height,"set-certificate-image"==t.attr("id"))e("#upload_image_id_0").val(n.id),e("#remove-certificate-image").show(),e("img#certificate_image_0").attr("src",n.url);else if("set-additional-image"==t.attr("id"))e("#upload_additional_image_id_0").val(n.id),e("#set-additional-image").hide(),e("#remove-additional-image").show(),e("img#certificate_additional_image").attr("src",n.url);else if("add-alternative-certificate-image"==t.attr("id")){var l=e("#certificate_alternative_images li").size()+1;e("#certificate_alternative_images").append('<li class="alternative_image"><a href="#" class="remove-alternative-certificate-image"><img style="max-width:100px;max-height:100px;" src="'+n.url+'" /><input type="hidden" name="upload_image_id['+l+']" class="upload_image_id" value="'+n.id+'" /><span class="overlay"></span></a></li>'),c()}}),i.open())}),e("#remove-certificate-image").click(function(){return e("#upload_image_id_0").val(""),e("img#certificate_image_0").attr("src",""),e(this).hide(),!1}),e(window).resize(function(){n()}),n(),e("input.set_position").click(function(){l(this.id)}),e("input.remove_position").click(function(){e(this).hide(),e("#_"+this.id.substr(7)).val(""),e("#"+this.id.substr(7)).val(sensei_certificate_templates_params.set_position_label),s()}),c(),e("#remove-additional-image").click(function(){return e("#upload_additional_image_id_0").val(""),e("img#certificate_additional_image").attr("src",""),e(this).hide(),e("#set-additional-image").show(),!1}),"function"!=typeof jQuery.fn.hasParent&&jQuery.extend(jQuery.fn,{hasParent:function(i){return this.filter(function(){return e(i).find(this).length})}})});